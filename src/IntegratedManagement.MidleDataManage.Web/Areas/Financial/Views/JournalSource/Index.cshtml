<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="~/Content/metroadmin/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/assets/bootstrap/css/bootstrap-fileupload.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/css/style.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/css/style-responsive.css" rel="stylesheet" />
    <link href="~/Content/metroadmin/css/style-default.css" rel="stylesheet" id="style_color" />
    <link href="~/Content/metroadmin/assets/fancybox/source/jquery.fancybox.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/Content/metroadmin/assets/uniform/css/uniform.default.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/metroadmin/assets/chosen-bootstrap/chosen/chosen.css" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="fixed-top">

    <!-- BEGIN CONTAINER -->
    <div id="container" style="margin-top:0px;" class="row-fluid">
        <!-- BEGIN PAGE -->
        <div id="main-content" style="margin:0px;">
            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid">
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12">
                        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                        <div class="widget">
                            <div class="widget-title">
                                <h4> 分录来源处理</h4>
                                <span class="tools">
                                    <a href="javascript:;" class="icon-chevron-down"></a>
                                </span>
                            </div>
                            <div class="widget-body">
                                <div class="form-horizontal">
                                    <div class="row-fluid">
                                        <div class="span3">
                                            <div class="control-group">
                                                <label class="control-label">订单号3：</label>
                                                <div class="controls">
                                                    <input type="text" class="span6" />
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">订单号4：</label>
                                                <div class="controls">
                                                    <input type="text" class="span6" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="span4">
                                            <div class="control-group">
                                                <label class="control-label">订单号1：</label>
                                                <div class="controls">
                                                    <input type="text" class="span8" />
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">订单号2：</label>
                                                <div class="controls">
                                                    <input type="text" class="span8" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="span4">
                                            <div class="control-group">
                                                <label class="control-label">分支：</label>
                                                <div class="controls">
                                                    <select data-placeholder="选择分支" class="chzn-select-deselect span8" tabindex="-1" id="selCSI">
                                                        <option value="1"></option>
                                                        <option value="2">American Black Bear American Black BearAmerican Black BearAmerican Black Bear</option>
                                                        <option value="3">Asiatic Black Bear</option>
                                                        <option value="4">Brown Bear</option>
                                                        <option value="5">Giant Panda</option>
                                                        <option value="6">Sloth Bear</option>
                                                        <option value="7">Sun Bear</option>
                                                        <option value="8">Polar Bear</option>
                                                        <option value="9">Spectacled Bear</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">订单号4：</label>
                                                <div class="controls">
                                                    <input type="text" class="span8" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="span1">
                                            <div class="control-group">
                                                    <button class="btn btn-inverse" id="searchBtn" type="button" style="margin-right:5px"><i class="icon-search"></i> </button>
                                            </div>
                                            <div class="control-group"style="min-width:60px">
                                                <input type="checkbox" id="selectAllDataChk" />
                                                <button class="btn btn-inverse" id="syncBtn" type="button" style="margin-right:5px"><i class="icon-refresh icon-white"></i> </button>
                                            </div>
                                        </div>
                                     </div>
                                </div>

                            </div>
                        </div>

                        <!-- END PAGE TITLE & BREADCRUMB-->
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- BEGIN ADVANCED TABLE widget-->
                <div class="row-fluid">
                    <div class="span12">
                        <!-- BEGIN EXAMPLE TABLE widget-->
                        <div class="widget">

                            <div class="widget-body">
                                <table class="table table-striped table-bordered" id="sample_1">
                                    <thead>
                                        <tr>
                                            <th style="width:8px;"><input type="checkbox" class="group-checkable" data-set="#sample_1 .checkboxes" /></th>
                                            <th class="hidden-phone">交易号</th>
                                            <th class="hidden-phone">分支</th>
                                            <th class="hidden-phone">ERP订单号</th>
                                            <th class="hidden-phone">来源表</th>
                                            <th class="hidden-phone">工作流</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- END EXAMPLE TABLE widget-->
                    </div>
                </div>
                <!-- END ADVANCED TABLE widget-->
            </div>
            <!-- END PAGE CONTAINER-->
        </div>
        <!-- END PAGE -->
    </div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div id="footer">
        2013 &copy; Metro Lab Dashboard.
    </div>
    <!-- END FOOTER -->
    <!-- BEGIN JAVASCRIPTS -->
    <!-- Load javascripts at bottom, this will reduce page load time -->
    <script src="~/Content/metroadmin/js/jquery-1.8.3.min.js"></script>
    <script src="~/Content/metroadmin/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="~/Content/metroadmin/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="~/Content/metroadmin/js/jquery.blockui.js"></script>
    <!-- ie8 fixes -->
    <!--[if lt IE 9]>
    <script src="js/excanvas.js"></script>
    <script src="js/respond.js"></script>
    <![endif]-->
    <script type="text/javascript" src="~/Content/metroadmin/assets/uniform/jquery.uniform.min.js"></script>
    <script type="text/javascript" src="~/Content/metroadmin/assets/chosen-bootstrap/chosen/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="~/Content/metroadmin/assets/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="~/Content/metroadmin/assets/data-tables/DT_bootstrap.js"></script>
    <script src="~/Content/metroadmin/js/jquery.scrollTo.min.js"></script>

    <script src="~/Content/metroadmin/js/common-scripts.js"></script>
    <script src="~/Content/metroadmin/js/dynamic-table.js"></script>
    <script src="~/Content/metroadmin/js/form-component.js"></script>

    <script>
        (function ($) {
            var selectAllData;
            $("#searchBtn").click(function () {
                $.search.searchClick();
            });
            $("#syncBtn").click(function () {
                $.search.syncClick();
            });
            $.search = {
                syncAllData: function (allData) {
                    $.ajax({
                        url: "/Financial/JournalSource/SyncAllData",
                        data: { JournalRelationMaps: eval(allData.replace("JournalSourceLines", "JournalRelationMapLines")) },
                        //data: {'Number':3,'TransId':1,'TransType':0,'BPLId':1,'ERPOrderNum':'1','SourceTable':'purchase','WorkFlow':'1','RefDate':'2017-09-02T00:00:00','DueDate':'2017-09-02T00:00:00','TaxDate':'2017-09-02T00:00:00','CreateDate':'2017-09-02T00:00:00','JournalSourceLines':[{'TransId':1,'LineId':1,'AcctCode':'1001','ShorName':'1001','BPLId':1,'Credit':0.0,'Debit':0.0,'ExpenseType':'1','PayCode':'3','WhsCode':'BJSP','ERPCardCode':null,'ERPBaseCardCode':null,'ERPDocEntry':null,'ERPBaseNum':null,'CardCode':null,'CardName':null},{'TransId':1,'LineId':2,'AcctCode':'1002','ShorName':'1002','BPLId':1,'Credit':0.0,'Debit':0.0,'ExpenseType':'1','PayCode':'3','WhsCode':'BJSP','ERPCardCode':null,'ERPBaseCardCode':null,'ERPDocEntry':null,'ERPBaseNum':null,'CardCode':null,'CardName':null}]},
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                alert("数据全部成功同步到中间表");
                            } else {
                                alert(data.message);
                            }
                        }
                    });
                    $.search.searchClick();
                },
                syncSelectedData: function(selecedIDsData){
                    $.ajax({
                        url: "/Financial/JournalSource/SyncSelectedData",
                        data: { IDs: selecedIDsData },
                        //data: {'Number':3,'TransId':1,'TransType':0,'BPLId':1,'ERPOrderNum':'1','SourceTable':'purchase','WorkFlow':'1','RefDate':'2017-09-02T00:00:00','DueDate':'2017-09-02T00:00:00','TaxDate':'2017-09-02T00:00:00','CreateDate':'2017-09-02T00:00:00','JournalSourceLines':[{'TransId':1,'LineId':1,'AcctCode':'1001','ShorName':'1001','BPLId':1,'Credit':0.0,'Debit':0.0,'ExpenseType':'1','PayCode':'3','WhsCode':'BJSP','ERPCardCode':null,'ERPBaseCardCode':null,'ERPDocEntry':null,'ERPBaseNum':null,'CardCode':null,'CardName':null},{'TransId':1,'LineId':2,'AcctCode':'1002','ShorName':'1002','BPLId':1,'Credit':0.0,'Debit':0.0,'ExpenseType':'1','PayCode':'3','WhsCode':'BJSP','ERPCardCode':null,'ERPBaseCardCode':null,'ERPDocEntry':null,'ERPBaseNum':null,'CardCode':null,'CardName':null}]},
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                alert("数据全部成功同步到中间表");
                            } else {
                                alert(data.message);
                            }
                        }
                    });
                    $.search.searchClick();
                },
                bindTable: function (data) {
                    var tbody = $("#sample_1 tbody");
                    tbody.find('tr').remove();
                    var journalList = eval(data);
                    var tr = "";
                    journalList.forEach(function (journal) {
                        tr += " <tr class='odd gradeX'><td><input type='checkbox' class='checkboxes' value='"+journal.TransId +"' /></td><td>" +
                            journal.TransId + "</td><td class='hidden-phone'>" +
                            journal.bplId + "</td><td class='hidden-phone'>" +
                            journal.ERPOrderNum + "</td><td class='hidden-phone'>" +
                            journal.SourceTable + "</td><td class='hidden-phone'>" +
                            journal.WorkFlow + "</td>";
                    });
                    tbody.append(tr);
                },
                syncClick: function () {
                    var bischecked = $('#selectAllDataChk').is(':checked');
                    if (bischecked) {
                        if (selectAllData == undefined || selectAllData == null){
                            alert("未选择数据");
                            return;
                        }
                        $.search.syncAllData(selectAllData);
                        //同步所有数据
                        
                    } else {
                        var selectedChData = '';
                        $(":checkbox:checked").each(function () {
                            var transId = $(this).val();
                            selectedChData += transId + ',';
                        });
                        if (selectedChData == undefined || selectedChData == null) {
                            alert("未选择数据");
                            return;
                        }
                        $.search.selectAndCreateJournal(selectedChData.toString());
                    }

                },
                searchClick: function () {
                    //获取查询条件


                    $.ajax({
                        url: "/Financial/JournalSource/SearchJournalSource",
                        data: { bplId: 1, "BPLName": "asdf" },
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                selectAllData = data.data;
                                $.search.bindTable(data.data);

                            } else {
                                alert(data);
                            }
                        }
                    });
                },
                
            };
        })(jQuery);
    </script>
</body>
<!-- END BODY -->
</html>

